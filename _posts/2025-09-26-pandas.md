---
# ====== Front Matter ======
title: "데이터처리 (Pandas)"
description: "Pandas를 활용한 데이터 처리"
date: 2025-09-26 21:00:00 +0900
categories: [Data, Pandas]
tags: [python, pandas]
pin: false
toc: true
comments: false
render_with_liquid: false
math: false
mermaid: false

lang: "ko"
---

## 데이터프레임 만들기

### 1. 데이터프레임 이해
- 데이터프레임(Dataframe)이란?
  - 데이터 분석에서 가장 중요한 데이터 구조
  - 관계형 데이터베이스의 테이블 또는 엑셀 시트와 같은 형태
  - 변수들의 집합 → 각 열을 변수라고 부른다.

![데이터프레임 예시 이미지](/assets/img/pandas/dataframe1.png){:width="420"}
_행을 관측치라고 하고, 열을 변수 라고 한다._

### 2. 데이터프레임 만들기
- 데이터프레임을 다루기 위해서는 Pandas 라이브러리를 불러와야 한다.

```python
# 라이브러리 불러오기
import pandas as pd
```

- DataFrame 함수를 사용해 데이터프레임을 만든다.
- 데이터프레임은 여러 열을 가지므로 인덱스 외에 열 이름에 대한 설정이 필요하다.
- 데이터프레임을 만들 때 열 이름을 직접 지정하거나, 나중에 변경할 수 있다.
- 열 이름을 지정하지 않으면 열 번호에 기반한 정수(0, 1, 2...)가 열 이름이 된다.
- 의미 있는 값(날짜가 대표적임)이 인덱스가 되면 분석이 용이하다.

---

- 리스트로 만들기

```python
# 2차원 리스트 만들기
stock = [[94500, 92100, 92200, 92300],
         [96500, 93200, 95900, 94300],
         [93400, 91900, 93400, 92100],
         [94200, 92100, 94100, 92400],
         [94500, 92500, 94300, 92600]]

# 데이터프레임 만들기
df = pd.DataFrame(stock)

# 확인
df.head()
```
![데이터프레임 예시 이미지](/assets/img/pandas/dataframe2.png){:width="300"}
_인덱스를 지정하지 않으면 행 번호가 인덱스, 열 번호가 열 이름으로 지정된다._

---

- 인덱스와 열 이름을 별도로 지정해서 만들기

```python
# 리스트 만들기
stock = [[94500, 92100, 92200, 92300],
         [96500, 93200, 95900, 94300],
         [93400, 91900, 93400, 92100],
         [94200, 92100, 94100, 92400],
         [94500, 92500, 94300, 92600]]
dates = ['2019-02-15', '2019-02-16', '2019-02-17', '2019-02-18', '2019-02-19']
names = ['High', 'Low', 'Open', 'Close']

# 데이터프레임 만들기
df = pd.DataFrame(stock, index=dates, columns=names)

# 확인
df.head()
```

![데이터프레임 예시 이미지](/assets/img/pandas/dataframe3.png){:width="300"}
_인덱스와 열 이름 설정_

---

- 딕셔너리로 데이터프레임을 만들면 **딕셔너리 키**가 **데이터프레임 열 이름**이 된다.
- 인덱스를 지정하지 않으면 행 번호가 인덱스가 된다.

```python
# 딕셔너리 만들기
cust = {'Name': ['Gildong', 'Sarang', 'Jiemae', 'Yeoin'],
        'Level': ['Gold', 'Bronze', 'Silver', 'Gold'],
        'Score': [56000, 23000, 44000, 52000]}
        
# 데이터프레임 만들기
df = pd.DataFrame(cust)

# 확인
df.head()
```

![데이터프레임 예시 이미지](/assets/img/pandas/dataframe4.png){:width="300"}

### 3. CSV파일에서 데이터불러오기
- CSV 파일을 읽어와 데이터프레임을 만드는 경우가 가장 일반적이다.
- Github에서 CSV 파일을 읽어오는 예

```python
# 데이터 읽어오기
path = 'csv파일 경로'
pop = pd.read_csv(path)

# 상위 10개만 확인
pop.head(10)
```

- read_csv() 함수 주요 옵션
  - sep: 구분자 지정(기본값 = 콤마)
  - header: 헤더가 될 행 번호 지정(기본값 = 0)
  - index_col: 인덱스 열 지정(기본값 = False)
  - names: 열 이름으로 사용할 문자열 리스트
  - skiprows: 처음 몇 줄을 무시할 것인지 지정, 리스트로 지정 가능

### 4. 인덱스 설정

- 파일에서 읽어올 때 인덱스 열을 지정할 수 있다.
- 인덱스 열을 지정하지 않으면 행 번호에 기반한 정수 값이 인덱스로 설정된다.
- 필요한 경우 일반 열 중 하나를 인덱스로 설정할 수 있다.
- 일반 열을 인덱스로 지정하는 예
```python
# 인덱스 설정
pop.set_index('year', inplace=True)
pop.head()
```

- 불필요한 인덱스 이름을 삭제하는 방법
```python
# 인덱스 이름 제거
pop.index.name = None
pop.head()
```

### 5. 인덱스 초기화
- reset_index() 메서드를 사용해 행 번호에 기반한 정수 값으로 인덱스 초기화 가능
- drop=True를 설정하면 기존 인덱스 열을 버린다.
- drop=False를 설정하면 기존 인덱스 열을 일반 열로 유지한다.(기본값)
- 기존 인덱스 값을 버리지 않은 예

```python
# 인덱스 초기화
pop.reset_index(drop=False, inplace=True)
pop.head()
```

- 'index'로 설정된 열 이름을 적절히 변경

```python
# 열 이름 변경
pop.rename(columns={'index': 'year'}, inplace=True)
pop.head()
```

## 데이터프레임 탐색
- 다양한 메서드와 속성을 사용해 데이터에 대해 살펴본다.
- 메서드인지 속성인지를 명확히 파악하고 사용해야 한다.

| 메서드 | 기능 |
|:--:|:--|
| head() | 지정한 수 만큼의 앞쪽 행 데이터 확인(기본값 5) |
| tail() | 지정한 수 만큼의 뒤쪽 행 데이터 확인(기본값 5) |
| info() | 인덱스, 열, 값 개수, 데이터 형식 정보 등 확인 |
| describe() | 기술 통계(Descriptive Statistics) 정보 확인 | 

| 속성 | 기능 |
|:--:|:--|
| shape | 데이터프레임 모양 확인 → (행수, 열수) 형태 |
| index | 인덱스 정보 확인 |
| values | 값 확인 |
| columns | 열 이름 확인 |
| dtypes | 각 열의 데이터 형식 확인 |

---

- info(), describe() 메서드는 상당히 많은 정보를 보여준다.
- 데이터 탐색 시 필히 확인하기를 권고
```python
df.info()
```
![데이터프레임 예시 이미지](/assets/img/pandas/dataframe5.png){:width="300"}

```python
df.describe()
```
![데이터프레임 예시 이미지](/assets/img/pandas/dataframe6.png){:width="300"}

### 1. 데이터 정렬
- sort_index() 메서드로 인덱스를 기준으로 정렬

```python
# 인덱스 기준 정렬
tip.sort_index(ascending=False)
```

- sort_values() 메서드로 특정 열을 기준으로 정렬

```python
# 단일 열 정렬
tip.sort_values(by='total_bill', ascending=False)
# 복합 열 정렬
tip.sort_values(by=['total_bill', 'tip'], ascending=[False, False])
```

- 정렬 방법
  - ascending=True: 오름차순 정렬(기본값)
  - ascending=False: 내림차순 정렬

### 2. 고윳값 확인
- unique() 메서드: 고윳값 확인

```python
# day 열 고윳값 확인
tip['day'].unique()
```

- value_counts() 메서드: 고윳값과 그 개수 확인
  - dropna=True 지정하거나 생략하면 NaN 값 제외

```python
# day 열 고윳값 개수 확인
tip['day'].value_counts()
```

- mode() 메서드: 고윳값 중 최빈값 확인

```python
# day 열 최빈값 확인
tip['day'].mode()
```

## 데이터프레임 조회

### 1. 특정 열 조회
- df.loc[ : , [열 이름1, 열 이름2,...]] 형태로 조회할 열 이름을 리스트로 지정
- 열 부분은 생략할 수 있었지만, 행 부분을 생략할 수는 없다.
- 하지만 df[[열 이름1, 열 이름2,...]] 형태로 인덱서를 생략함이 일반적이다.

```python
# total_bill 열 조회
tip[['total_bill']].head()
```

```python
# tip, total_bill 열 조회
tip[['tip', 'total_bill']].head()
```

- 조회할 열이 하나면 리스트 형태가 아니어도 된다.(결과는 시리즈가 된다.)

```python
# total_bill 열 조회
tip['total_bill'].head()
```

### 2. 조건으로 조회
- isin(), between() 메서드
  - isin([값1, 값2,..., 값n]): 값1 또는 값2 또는...값n인 데이터만 조회

```python
# 값 나열
tip.loc[tip['day'].isin(['Sat', 'Sun'])]
```

- between(값1, 값2): 값1 ~ 값2까지 범위안의 데이터만 조회

```python
# 범위 지정
tip.loc[tip['size'].between(1, 3)]
```

## 데이터프레임 변경

### 1. 열 이름 변경
- 방법1: columns 속성 변경 → 모든 열 이름 변경

```python
# 속성 변경
tip.columns = ['total_bill', 'tip', 'sex', 'smoker', 'day', 'time', 'size']
```

- 방법 2: rename() 메서드 사용 → 지정한 열 이름 변경

```python
# 열 이름 변경
tip.rename(columns={'total_bill_amount': 'total_bill',
'male_female': 'sex',
'smoke_yes_no': 'smoker',
'week_name': 'day',
'dinner_lunch': 'time'}, inplace=True)
```

### 2. 열 추가

- 맨 뒤에 열 추가
  - 없는 열을 변경하면 그 열이 추가된다.
  - 맨 뒤 열로 추가되며, 원하는 위치에 열을 추가할 수는 없다.

```python
# final_amt 열 추가
tip['final_amt'] = tip['total_bill'] + tip['tip']
```

- 지정한 위치에 열 추가
  - insert() 메서드를 사용하면 원하는 위치에 열을 추가할 수 있다.

```python
# tip 열 앞에 tip_tb 열 추가
tip.insert(1, 'tip_tb', tip['total_bill'] / tip['size'])
```

### 3. 열 삭제
- drop() 메서드를 사용해 열 삭제
  - axis=0: 행 삭제(기본 값)
  - axis=1: 열 삭제

```python
# 열 하나 삭제
tip.drop('final_amt', axis=1, inplace=True)

# 열 두 개 삭제
tip.drop(['tip_tb', 'day'], axis=1, inplace=True)
```

### 4. 결측치 확인
- 결측치 존재 여부를 확인하고 이를 어떻게 처리할 지 방법을 결정
- info() 메서드로 확인 → 전체 행 개수보다 값 개수가 적은 경우 결측치 존재

```python
# 값 개수로 결측치 존재 여부 확인
air.info()
```

- isnull() 메서드: 결측치는 True, 유효한 값은 False 반환
- notnull() 메서드: 결측치는 False, 유효한 값은 True 반환
- isnull() 대신 isna(), notnull() 대신 notna() 메서드 사용 가능

```python
# 전체 데이터 중에서 결측치는 True로 표시
air.isna()
```

```python
# 전체 데이터 중에서 결측치는 False로 표시
air.notna()
```

- isnull() 메서드 결과에 sum() 메서드를 사용해 결측치 개수 확인

```python
# 열의 결측치 개수 확인
air.isnull().sum()
```

### 5. 결측치 제거
- dropna() 메서드로 결측치가 있는 열이나 행을 제거할 수 있다.
- 어떤 열이든 결측치가 있는 행 제거

```python
# 결측치가 하나라도 있는 행 제거
air_test.dropna(axis=0, inplace=True)
```

- 특정 열에 결측치가 있는 행 제거

```python
# Ozone 열이 결측치인 행 제거
air_test.dropna(subset=['Ozone'], axis=0, inplace=True)
```

- 결측치가 있는 열 제거

```python
# 결측치가 있는 열 제거
air_test.dropna(axis=1, inplace=True)
```

### 6. 결측치 채우기

- fillna() 메서드를 사용해 결측치를 다른 값으로 채울 수 있다.
- 평균값으로 채우기
  - 결측치가 있는 열의 평균값을 구한 후 결측치를 그 값으로 채운다.

```python
# 결측치를 평균값으로 채우기
mean_Ozone = air_test['Ozone'].mean()
air_test['Ozone'] = air_test['Ozone'].fillna(mean_Ozone)
```

- 특정 값으로 채우기

```python
# Solar.R 열의 누락된 값을 0으로 채우기
air_test['Solar.R'] = air_test['Solar.R'].fillna(0)
```

- 직전 행의 값 또는 바로 다음 행의 값으로 채우기
  - ffill() 메서드: 바로 앞의 값으로 변경
  - bfill() 메서드: 바로 다음 값으로 변경

```python
# Ozone 열의 누락된 값을 바로 앞의 값으로 채우기
air_test['Ozone'] = air_test['Ozone'].ffill()

# Solar.R 열의 누락된 값을 바로 뒤의 값으로 채우기
air_test['Solar.R'] = air_test['Solar.R'].bfill()
```

- interpolate() 메서드를 사용해 선형보간법으로 채울 수 있다.

```python
# 선형보간법으로 채우기
air_test['Ozone'] = air_test['Ozone'].interpolate(method='linear')
air_test['Solar.R'] = air_test['Solar.R'].interpolate(method='linear')
```

### 7. 데이터프레임 합치기
- concat() 함수로 인덱스 값을 기준으로 여러 데이터프레임을 합칠 수 있다.
- 방향 선택
  - axis=0 옵션 → 세로(행)로 합치기 (기본값) / axis=1 옵션 → 가로(열)로 합치기
- 방법 선택
  - outer 옵션 → 모든 행과 열 합치기 / inner 옵션 → 매핑되는 행과 열만 합치기

- join='outer' 옵션

```python
pop = pd.concat([pop01, pop02], join='outer', axis=1)
```

- join='inner' 옵션

```python
pop = pd.concat([pop01, pop02], join='inner', axis=1)
```

### 8. 데이터프레임 조인
- merge() 함수를 사용 두 데이터프레임을 지정한 키 값을 기준으로 병합할 수 있다.

- how='inner'

```python
pop = pd.merge(pop01, pop02, on='year', how='inner')
```

- how='outer'

```python
pop = pd.merge(pop01, pop02, on='year', how='outer')
```